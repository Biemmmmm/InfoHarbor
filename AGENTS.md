# AGENT 指南 – InfoHarbor 个人信息坞 / 信息操作系统

本文件用于指导 AI Coding Agent（例如 Codex）在本项目中的行为方式、技术选型、约束与优先级。

---

## 1. 项目定位与优先目标

**InfoHarbor 是一个通用的个人信息操作系统（Personal Information OS）**，主要解决以下问题：

- 多源信息过载，认知负荷过高；
- 注意力在多个 App/网站之间被打散；
- 用户难以系统记录自己对信息的理解与判断；
- 系统难以根据用户行为和偏好持续改进。

在设计和实现任何功能时，请优先考虑：

1. 是否有助于降低信息噪音、减少无效浏览；
2. 是否有助于帮助用户在一处集中处理高价值信息；
3. 是否有助于记录用户自己的认知与评价；
4. 是否有助于系统利用交互数据，更好地拟合用户偏好，实现“越用越好用”。

---

## 2. 文档与规范优先级

在本仓库工作时，遵循以下优先级查看文档：

1. `docs/PRD.md` – 产品需求与范围（当前 V1 说明）；
2. （如存在）`docs/ARCHITECTURE.md` – 架构设计；
3. （如存在）`docs/API.md` – 接口定义；
4. 现有代码实现。

若文档与代码不一致：

- 以最新的 PRD/架构文档为准；
- 先更新文档，再调整代码，保持一致性。

---

## 3. 默认技术栈

除非另有说明，本项目默认使用：

- **后端**
  - Python 3.11+
  - FastAPI
  - PostgreSQL
  - （可选）Redis 或其他队列组件用于后台任务

- **前端**
  - Next.js (React + TypeScript)
  - Tailwind CSS（深色/黑色主题优先）

- **基础设施**
  - Docker / docker-compose
  - Makefile 或脚本用于本地开发和测试

如需修改技术栈或引入新的基础设施，请先在相关文档中说明原因和影响。

---

## 4. 目录结构建议

推荐的项目结构如下（若不存在，可在实现过程中逐步建立）：

```text
.
├── AGENTS.md
├── docs/
│   ├── PRD.md
│   ├── ARCHITECTURE.md
│   └── API.md
├── backend/
│   ├── app/
│   │   ├── main.py
│   │   ├── api/
│   │   ├── models/
│   │   ├── schemas/
│   │   ├── services/
│   │   └── core/
│   ├── tests/
│   └── alembic/
├── frontend/
│   ├── app/
│   ├── components/
│   ├── lib/
│   └── tests/
└── infra/
    ├── docker-compose.yml
    ├── Dockerfile.backend
    ├── Dockerfile.frontend
    └── scripts/
        ├── dev_env.sh
        ├── run_backend.sh
        ├── run_frontend.sh
        └── run_tests.sh
```

---

## 5. 领域模块划分（后端）

请尽量按领域/职责拆分模块，而不是将所有逻辑堆叠在少数文件中。建议的后端模块划分：

* `sources/`

  * 负责外部信息源（RSS，Telegram 等）的接入；
  * 对外统一输出 RawEvent。

* `processing/`

  * NLP 和规则处理：

    * 摘要生成；
    * 主题分类；
    * 重要度打分；
    * InfoCard 聚合；
    * 交易信号解析（行动域示例）。

* `cards/`

  * InfoCard 和（可选）PatternCard 的数据模型与业务逻辑；
  * 包括查询、过滤和排序规则。

* `attention/`

  * 注意力预算；
  * 将 InfoCard 分配到 Today / This Week / Background 等列。

* `feedback/`

  * 用户反馈和评分（有用/无用、评分、稍后阅读、归档等）。

* `notes/`

  * 用户针对 InfoCard 的自由笔记/评论（认知记录）。

* `trading_signals/`

  * 行动域示例：交易信号的结构化数据模型和查询；
  * 注意：不负责实际交易执行。

* `api/`

  * 面向前端的 REST API 层。

前端模块应与之对应（例如组件 `InfoCard`, `BoardColumn`, `CardDetailDrawer`, `NoteEditor`, `FilterBar` 等）。

---

## 6. 开发任务处理流程

当被要求实现或修改某个功能时，推荐流程：

1. 在 `docs/PRD.md` 中找到对应章节，理解目标和约束；
2. 如需求复杂或涉及架构调整：

   * 先在 `docs/ARCHITECTURE.md` 中添加/更新设计说明；
3. 拆分为多个小任务：

   * 定义/更新数据模型；
   * 实现服务逻辑；
   * 暴露/调整 API；
   * 实现前端 UI 组件与交互；
   * 编写/更新测试；
4. 控制每次改动的范围，使之容易理解和回顾。

---

## 7. 后端实现要求

* 使用类型标注和 Pydantic 模型，保证接口和数据结构清晰；
* 优先通过 ORM 进行数据访问；
* 将 LLM 调用（如摘要、分类、解析）集中在专门模块中（例如 `services/llm_client.py`），便于替换和配置；
* 需要重点关注的功能包括：

  * RawEvent 采集；
  * InfoCard 生成与聚合；
  * 注意力预算与卡片分配；
  * 用户反馈记录；
  * 用户笔记记录；
  * 交易信号解析（仅结构化，不执行交易）。

---

## 8. 前端实现要求

* 使用 TypeScript 严格模式；
* 使用 Tailwind 实现深色主题、信息密度适中但结构清晰的界面；
* Dashboard UI 重点：

  * 清晰的看板列（Today / This Week / Background）；
  * InfoCard 上展示摘要、来源、标签、评分等关键信息；
  * 支持按主题、时间、来源过滤；
  * 卡片详情中提供：

    * 原文/链接；
    * 摘要和元数据；
    * 用户笔记编辑区域；
    * 反馈按钮（标记有用/无用、评分等）。

---

## 9. 测试与质量

* 后端测试：

  * InfoCard 生成与聚合逻辑；
  * 注意力预算和卡片分配算法；
  * 交易信号解析函数（含异常输入）；
  * 接口层的基本集成测试。

* 前端测试：

  * 核心组件渲染；
  * 关键交互（拖动/移动卡片、提交笔记、提交反馈等）。

* 工具建议：

  * Python：`black`，`isort`，`ruff`；
  * TypeScript：`eslint` + `prettier`。

---

## 10. 外部依赖与安全

* 不在代码中硬编码任何 API Key 或敏感凭证；
* 所有外部服务调用通过配置/环境变量注入；
* Codex Cloud 沙箱环境通常不能访问外网：

  * 请为外部服务定义抽象接口和 mock 实现；
  * 真实环境下由人类在本地/服务器上配置实际客户端。

**重要限制：**

* V1 阶段不实现真实交易执行逻辑，任何与真实资金相关的自动化动作都不应由代理直接编写；
* 如需为未来版本预留接口，应只到“生成交易请求数据结构”级别，不包含调用真实交易所 API 的实现。

---

## 11. 决策原则（遇到不确定情况时）

如果 PRD 或其他文档未明确指定行为，优先选择：

1. 能更好地帮助用户：

   * 降低信息噪音；
   * 减少不必要的界面/功能复杂度；
   * 提供清晰的认知记录渠道；
2. 能更好利用用户交互数据进行个性化拟合的设计；
3. 在当前阶段实现成本合理，但不封死未来扩展路径的方案。

简要原则：

> 先保证“统一入口 + 降噪 + 认知记录 + 基础个性化”这四件事稳定可靠，
> 再在此基础上考虑更多高级功能与自动化。